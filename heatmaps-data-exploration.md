# R Libraries needed

```{r libraries}
library(ggplot2)
library(magrittr)
library(gridExtra)
remotes::install_github("torvaney/ggsoccer")
library(ggsoccer)
library(tidyverse)
library(RColorBrewer)
```
## Creation of the EventMin variable in order to view events in the standard gametime minute rather than seconds

```{r create eventMin Variable}
england_shots_full <- england_shots_full %>% 
   mutate(eventMin = eventSec / 60)
england_shots_full$goal <- as.character(england_shots_full$goal)

england_shots_full$eventMin <- ifelse(england_shots_full$matchPeriod =='2H', england_shots_full$eventMin+45, england_shots_full$eventMin+0)
```
## Eliminating shot outliers

```{r eliminating outlier shots and goals}
england_shots_full <- subset(england_shots_full, `x start` > 50)
france_shots_full <- subset(france_shots_full, `x start` > 50)
germany_shots_full <- subset(germany_shots_full, `x start` > 50)
italy_shots_full <- subset(italy_shots_full, `x start` > 50)
spain_shots_full <- subset(spain_shots_full, `x start` > 50)
```

## Basic Exploration

```{r bar graph for goal scoring times}
england_shots_full %>% filter(`goal` == '1') %>%
  mutate(goals_bin = cut(`eventMin`, breaks=c(0, 5, 10, 15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,105))) %>%
  ggplot(aes(x = `goals_bin`))+
    geom_bar(stat = 'count',width=0.5, fill = 'dodgerblue1')+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"),
        axis.text.y = element_text(family = 'Tahoma', face = 'bold'),
        axis.title.x = element_text(face = 'bold', size = 12),
        axis.title.y = element_text(face = 'bold', size = 12),
        panel.background = element_rect(fill='grey'),
        axis.line = element_line(colour = "black"),
        panel.grid.major = element_line(colour = "white", size = (0.3)),
        panel.border = element_rect(colour = "black", fill=NA, size=1))+
    labs(title = 'Goals Scored by Minute',subtitle = 'In the Premier League', y = 'Count', x = 'Match Time (Minutes)', fill = 'Half')
```
![image](https://user-images.githubusercontent.com/70713627/210665747-c4e7525d-81ca-445c-a66c-71586af43601.png)

```{r bar graph for event distribution}
options(scipen = 100)
events_england %>%
  mutate(eventName = fct_relevel(eventName, 
            "Pass", "Duel","Others on the ball","Free Kick","Interruption","Shot","Foul","Save attempt","Offside", "Goalkeeper leaving line",)) %>%
  ggplot(aes(x = `eventName`))+
    geom_bar(stat = 'count', fill = 'dodgerblue1')+
    theme(axis.text.x = element_text(angle = 45, hjust = 1),plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"),
        axis.text.y = element_text(family = 'Tahoma', face = 'bold'),
        axis.title.x = element_text(face = 'bold', size = 12),
        axis.title.y = element_text(face = 'bold', size = 12),
        panel.background = element_rect(fill='grey'),
        axis.line = element_line(colour = "black"),
        panel.grid.major = element_line(colour = "white", size = (0.3)),
        panel.border = element_rect(colour = "black", fill=NA, size=1))+
    labs(title = 'Event Distribution',subtitle = 'In the Premier League', y = 'Count', x = '', fill = 'Half')
```
![image](https://user-images.githubusercontent.com/70713627/210665825-d3454edc-1e35-4697-9b5d-85ac726a1b22.png)


# Comparing winning teams and losing teams by using assist and shot maps to discover useful strategies. Using FC Barcelona and Juventus as the winners, and FC Metz and West Bromwich FC as the losers.

## Shots

```{r shot map juventus}
juventus_shots <- italy_shots_full %>%
  filter(italy_shots_full$teamId == '3159')
ggplot(juventus_shots, aes(x = `x start`, y = `y start`)) +
annotate_pitch(dimensions = pitch_wyscout, fill = "springgreen4", colour = "white", goals = goals_line) +
  theme_pitch()+
   theme(plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"))+
  geom_density_2d_filled(contour_var = 'ndensity', alpha = .5, breaks = seq(0.001, 1.0, length.out = 10))+
  scale_fill_brewer(palette = "YlOrRd")+
  theme(panel.background = element_rect(fill = "springgreen4"), legend.position = 'none')+
  direction_label(x_label = 50, colour = 'white')+
  labs(title = 'Shot Map: Juventus', subtitle = '2017-2018 Serie A Season', caption = 'Created by Justin Kleindienst\nData from Wyscout.com\n Generated by ggSoccer')
```
![image](https://user-images.githubusercontent.com/70713627/210668148-5ac0a251-a706-41e6-a45b-a624ccb435e1.png)

```{r}
metz_shot <- france_shots_full %>%
  filter(france_shots_full$teamId == '3777')
ggplot(metz_shot, aes(x = `x start`, y = `y start`)) +
annotate_pitch(dimensions = pitch_wyscout, fill = "springgreen4", colour = "white", goals = goals_line) +
  theme_pitch()+
  theme(plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"))+
  geom_density_2d_filled(contour_var = 'ndensity', alpha = .5, breaks = seq(0.001, 1.0, length.out = 10))+
  scale_fill_brewer(palette = "YlOrRd")+
  theme(panel.background = element_rect(fill = "springgreen4"), legend.position = 'none')+
  direction_label(x_label = 50, colour = 'white')+
  labs(title = 'Shot Map: FC Metz', subtitle = '2017-2018 La Liga Season', caption = 'Created by Justin Kleindienst\nData from Wyscout.com\n Generated by ggSoccer')
```

![image](https://user-images.githubusercontent.com/70713627/210668271-aeb05041-b9a5-406b-81b5-61b9c9d6bf75.png)

### Using the comparison between Juventus and FC Metz and their respective shot maps, we can see that there may be an advantage to taking longer chances and chances from wider angles to possibly take goal keepers and defenders off guard, rather than shooting from the best possible angle which is straight ahead

## Assists

```{r}
barcelona_assist <- spain_assists %>%
  filter(spain_assists$teamId == '676' & spain_assists$assist == '1')
ggplot(barcelona_assist, aes(x = `x start`, y = `y start`)) +
annotate_pitch(dimensions = pitch_wyscout, fill = "springgreen4", colour = "white", goals = goals_line) +
  theme_pitch()+
  theme(plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"))+
  geom_density_2d_filled(contour_var = 'ndensity', alpha = .5, breaks = seq(0.001, 1.0, length.out = 10))+
  scale_fill_brewer(palette = "YlOrRd")+
  theme(panel.background = element_rect(fill = "springgreen4"), legend.position = 'none')+
  direction_label(x_label = 50, colour = 'white')+
  labs(title = 'Assist Map: Barcelona', subtitle = '2017-2018 La Liga Season', caption = 'Created by Justin Kleindienst\nData from Wyscout.com\n Generated by ggSoccer')
```
![image](https://user-images.githubusercontent.com/70713627/210668575-133fe714-64a5-4ae5-8ad4-20b59ee6fcc4.png)

```{r}
west_brom_assist <- england_assists %>%
  filter(england_assists$teamId == '1627' & england_assists$assist == '1')
ggplot(west_brom_assist, aes(x = `x start`, y = `y start`)) +
annotate_pitch(dimensions = pitch_wyscout, fill = "springgreen4", colour = "white", goals = goals_line) +
  theme_pitch()+
  theme(plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"))+
  geom_density_2d_filled(contour_var = 'ndensity', alpha = .5, breaks = seq(0.001, 1.0, length.out = 10))+
  scale_fill_brewer(palette = "YlOrRd")+
  theme(panel.background = element_rect(fill = "springgreen4"), legend.position = 'none')+
  direction_label(x_label = 50, colour = 'white')+
  labs(title = 'Assist Map: West Brom', subtitle = '2017-2018 Premier League Season', caption = 'Created by Justin Kleindienst\nData from Wyscout.com\n Generated by ggSoccer')
```
![image](https://user-images.githubusercontent.com/70713627/210668623-96d613b1-ac61-4217-a4d3-7be24b2ed356.png)

### Using the assists comparison, we can see an established strategy from Barcelona on where the key passes are made that lead to goals. Down the wings and the occaisonal thru ball in the middle. West Brom on the other hand has no distinct strategy that we can determine from their assist locations.

## Goals

```{r}
Metz_goal <- france_shots_full %>%
  filter(france_shots_full$teamId == '3777' & france_shots_full$goal == '1')
ggplot(Metz_goal, aes(x = `x start`, y = `y start`)) +
annotate_pitch(dimensions = pitch_wyscout, fill = "springgreen4", colour = "white", goals = goals_line) +
  theme_pitch()+
  theme(plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"))+
  geom_density_2d_filled(contour_var = 'ndensity', alpha = .5, breaks = seq(0.001, 1.0, length.out = 10))+
  scale_fill_brewer(palette = "YlOrRd")+
  theme(panel.background = element_rect(fill = "springgreen4"), legend.position = 'none')+
  direction_label(x_label = 50, colour = 'white')+
  labs(title = 'Goal Map: FC Metz', subtitle = '2017-2018 Ligue 1 Season', caption = 'Created by Justin Kleindienst\nData from Wyscout.com\n Generated by ggSoccer')
```

![image](https://user-images.githubusercontent.com/70713627/211110445-d536690f-3964-493d-9c69-75cc20847825.png)

```{r}
juventus_goal <- italy_shots_full %>%
  filter(italy_shots_full$teamId == '3159' & italy_shots_full$goal == '1')
ggplot(juventus_goal, aes(x = `x start`, y = `y start`)) +
annotate_pitch(dimensions = pitch_wyscout, fill = "springgreen4", colour = "white", goals = goals_line) +
  theme_pitch()+
   theme(plot.title= element_text(size=20,
                                   color="black",
                                   face="bold",
                                   family = "Tahoma"))+
  geom_density_2d_filled(contour_var = 'ndensity', alpha = .5, breaks = seq(0.001, 1.0, length.out = 10))+
  scale_fill_brewer(palette = "YlOrRd")+
  theme(panel.background = element_rect(fill = "springgreen4"), legend.position = 'none')+
  direction_label(x_label = 50, colour = 'white')+
  labs(title = 'Goal Map: Juventus', subtitle = '2017-2018 Serie A Season', caption = 'Created by Justin Kleindienst\nData from Wyscout.com\n Generated by ggSoccer')
```

![image](https://user-images.githubusercontent.com/70713627/211110514-4cb3e82f-a3a7-4e7b-b939-fd95e5ca8077.png)

### Lastly from the goal maps, we can see that Juventus was taking much wider angles and scoring from those angles as well. FC Metz on the other hand had a very narrow shot map and only reall scored from the 6 yardline and nowhere else. This shows that teams need to shoot from amny different places instead of trying to get as close as possible for the easiest shot. 


